<title>Door</title>
<pre style="font-family: 'Monaco', monospace; font-size: 0.7em; line-height: 0.7em;">
</pre>
<script>
  function vabs(a,b) { return [Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])]; }
  function vadd(a,b) { return [a[0]+b[0],a[1]+b[1],a[2]+b[2]]; }
  function vsub(a,b) { return [a[0]-b[0],a[1]-b[1],a[2]-b[2]]; }
  function box(size,ms) {
    return function (x, y, z) {
      var vdist0 = Math.abs(x) - size[0];
      var vdist1 = Math.abs(y) - size[1];
      var vdist2 = Math.abs(z) - size[2];
      return {
        d: Math.max(vdist0, vdist1, vdist2),
        m: vdist0 > vdist1 && vdist0 > vdist2 ? ms[0] :
           vdist1 > vdist0 && vdist1 > vdist2 ? ms[1] :
           ms[2]
      };
    };
  }
  function translate(vec, obj) {
    var dx = vec[0];
    var dy = vec[1];
    var dz = vec[2];
    return function (x, y, z) { return obj(x - dx, y - dy, z - dz); }
  }
  function spin(obj) {
    return function (x, y, z) {
      var a = Date.now() / 300;
      var s = Math.sin(a);
      var c = Math.cos(a);
      return obj(
        x * c + z * s,
        y,
        x * -s + z * c
      );
    };
  }
  function rotx(a, obj) {
    return function (x, y, z) {
      var s = Math.sin(a);
      var c = Math.cos(a);
      return obj(
        x,
        y * c + z * s,
        y * -s + z * c
      );
    };
  }
  function union(as, bs) {
    return function (x, y, z) {
      var a = as(x, y, z);
      var b = bs(x, y, z);
      return a.d > b.d ? b : a;
    };
  }

  var vw = 80, vh = 80;

  var door = translate([0, 10, 0], spin(translate([0, 0, 10], box([1, 20, 10], [":", "\u2014", "|"]))));
  var floor = translate([0, -10, 0], box([100, 1, 100], ["/","/","/"]));
  var scene = union(door, floor);
  var view = translate([vw/2, vh/2, -100], rotx(0.2, scene));

  var distant = { d: 0, m: " " };
  function r() {
    var t = "";
    for (var y = vh - 1; y >= 0; y--) {
      for (var x = 0; x < vw; x++) {
        var z = 0, res;
        while ((res = view(x,y,z)).d > 1e-3) {
          z -= res.d;
          if (!isFinite(z) || z < -1000) {
            res = distant;
            break;
          }
        }
        //t += z;
        t += res.m;
      }
      t += "\n";
    }
    document.getElementsByTagName("pre")[0].textContent=t;
  }
  setInterval(r, 1000/30);
</script>
